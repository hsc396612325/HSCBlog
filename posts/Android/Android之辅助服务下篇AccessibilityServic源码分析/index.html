<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Android之辅助服务下篇————AccessibilityServic源码分析 | 冰炭不投day的博客</title>
    <meta property="og:title" content="Android之辅助服务下篇————AccessibilityServic源码分析 - 冰炭不投day的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2018-07-10T22:40:54&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2018-07-10T22:40:54&#43;08:00'>
        
    <meta name="Keywords" content="Android 冰炭不投day">
    <meta name="description" content="Android之辅助服务下篇————AccessibilityServic源码分析">
        
    <meta name="author" content="冰炭不投day">
    <meta property="og:url" content="http://blog.bingtan.online/posts/Android/Android%E4%B9%8B%E8%BE%85%E5%8A%A9%E6%9C%8D%E5%8A%A1%E4%B8%8B%E7%AF%87AccessibilityServic%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-4031353640611810",
        enable_page_level_ads: true
    });
    </script>
    


    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://blog.bingtan.online">
                        冰炭不投day的博客
                    </a>
                
                <p class="description">若向往 我敢往</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="http://blog.bingtan.online">首页</a>
                    
                    <a  href="http://blog.bingtan.online/tools/" title="工具">工具</a>
                    
                    <a  href="http://blog.bingtan.online/archives/" title="归档">归档</a>
                    
                    <a  href="http://blog.bingtan.online/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Android之辅助服务下篇————AccessibilityServic源码分析</h1>
        </header>
        <date class="post-meta meta-date">
            2018年7月10日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='http://blog.bingtan.online/categories/Android'>Android</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        

        
        
        <div class="post-content">
            <h3 id="一前言">一.前言</h3>
<p>在上一篇博客中，我介绍了辅助服务的大致使用。这一篇我们来看看AccessibilityServic的原理。</p>
<p>通过上篇，我们知道将AccessibilityServic配置完成后。之后的使用可以分为下面三个步骤</p>
<ul>
<li>onAccessibilityEvent接收事件(屏幕变化，点击事件)</li>
<li>通过控件文字或者id在当前屏幕里寻找对应的控件</li>
<li>调用控件的performAction进行相应的操作</li>
</ul>
<p>所以我们源码分析也是着重于上面的三个流程</p>
<ul>
<li>点击事件如何分发到onAccessibilityEvent</li>
<li>findAccessibilityNodeInfosByText如果通过控件文字找到对应的控件</li>
<li>performAction如何模拟操作控件</li>
</ul>
<h3 id="二接收accessibilityevent事件">二.接收AccessibilityEvent事件</h3>
<h4 id="1view对点击事件的分发">1.View对点击事件的分发</h4>
<p>我们以View的点击事件发送到AccessibilityEvent为例。
从View的事件分发onTouchEvent为起点</p>
<blockquote>
<p>所在类：View.java</p>
</blockquote>
<p>onTouchEvent</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">onTouchEvent</span><span style="color:#000;font-weight:bold">(</span>MotionEvent event<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span>

        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>clickable <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> <span style="color:#000;font-weight:bold">(</span>viewFlags <span style="color:#000;font-weight:bold">&amp;</span> TOOLTIP<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> TOOLTIP<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">switch</span> <span style="color:#000;font-weight:bold">(</span>action<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">case</span> MotionEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_UP</span><span style="color:#000;font-weight:bold">:</span>
                    mPrivateFlags3 <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">~</span>PFLAG3_FINGER_DOWN<span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>viewFlags <span style="color:#000;font-weight:bold">&amp;</span> TOOLTIP<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> TOOLTIP<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        handleTooltipUp<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>clickable<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        removeTapCallback<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        removeLongPressCallback<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        mInContextButtonPress <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
                        mHasPerformedLongPress <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
                        mIgnoreNextUpEvent <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                    <span style="color:#458;font-weight:bold">boolean</span> prepressed <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>mPrivateFlags <span style="color:#000;font-weight:bold">&amp;</span> PFLAG_PREPRESSED<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>mPrivateFlags <span style="color:#000;font-weight:bold">&amp;</span> PFLAG_PRESSED<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> prepressed<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#998;font-style:italic">// take focus if we don&#39;t have it already and we should in
</span><span style="color:#998;font-style:italic"></span>                        <span style="color:#998;font-style:italic">// touch mode.
</span><span style="color:#998;font-style:italic"></span>                        <span style="color:#458;font-weight:bold">boolean</span> focusTaken <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>isFocusable<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> isFocusableInTouchMode<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">!</span>isFocused<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            focusTaken <span style="color:#000;font-weight:bold">=</span> requestFocus<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">}</span>

                        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>prepressed<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            <span style="color:#998;font-style:italic">// The button is being released before we actually
</span><span style="color:#998;font-style:italic"></span>                            <span style="color:#998;font-style:italic">// showed it as pressed.  Make it show the pressed
</span><span style="color:#998;font-style:italic"></span>                            <span style="color:#998;font-style:italic">// state now (before scheduling the click) to ensure
</span><span style="color:#998;font-style:italic"></span>                            <span style="color:#998;font-style:italic">// the user sees it.
</span><span style="color:#998;font-style:italic"></span>                            setPressed<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span> x<span style="color:#000;font-weight:bold">,</span> y<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">}</span>

                        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>mHasPerformedLongPress <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">!</span>mIgnoreNextUpEvent<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            <span style="color:#998;font-style:italic">// This is a tap, so remove the longpress check
</span><span style="color:#998;font-style:italic"></span>                            removeLongPressCallback<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                            <span style="color:#998;font-style:italic">// Only perform take click actions if we were in the pressed state
</span><span style="color:#998;font-style:italic"></span>                            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>focusTaken<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                                <span style="color:#998;font-style:italic">// Use a Runnable and post this rather than calling
</span><span style="color:#998;font-style:italic"></span>                                <span style="color:#998;font-style:italic">// performClick directly. This lets other visual state
</span><span style="color:#998;font-style:italic"></span>                                <span style="color:#998;font-style:italic">// of the view update before click actions start.
</span><span style="color:#998;font-style:italic"></span>                                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mPerformClick <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                                    mPerformClick <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> PerformClick<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                                <span style="color:#000;font-weight:bold">}</span>
                                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>post<span style="color:#000;font-weight:bold">(</span>mPerformClick<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                                    performClickInternal<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                                <span style="color:#000;font-weight:bold">}</span>
                            <span style="color:#000;font-weight:bold">}</span>
                        <span style="color:#000;font-weight:bold">}</span>

                        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mUnsetPressedState <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            mUnsetPressedState <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> UnsetPressedState<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">}</span>

                        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>prepressed<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            postDelayed<span style="color:#000;font-weight:bold">(</span>mUnsetPressedState<span style="color:#000;font-weight:bold">,</span>
                                    ViewConfiguration<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getPressedStateDuration</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>post<span style="color:#000;font-weight:bold">(</span>mUnsetPressedState<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            <span style="color:#998;font-style:italic">// If the post failed, unpress right now
</span><span style="color:#998;font-style:italic"></span>               <span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

</code></pre></td></tr></table>
</div>
</div><p>点击事件是在  performClickInternal()中，我们继续追踪</p>
<blockquote>
<p>所在类：View.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">performClickInternal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#998;font-style:italic">// Must notify autofill manager before performing the click actions to avoid scenarios where
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// the app has a click listener that changes the state of views the autofill service might
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// be interested on.
</span><span style="color:#998;font-style:italic"></span>        notifyAutofillManagerOnClick<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">return</span> performClick<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

	<span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">performClick</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#998;font-style:italic">// We still need to call this method to handle the cases where performClick() was called
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// externally, instead of through performClickInternal()
</span><span style="color:#998;font-style:italic"></span>        notifyAutofillManagerOnClick<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">boolean</span> result<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> ListenerInfo li <span style="color:#000;font-weight:bold">=</span> mListenerInfo<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>li <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> li<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mOnClickListener</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            playSoundEffect<span style="color:#000;font-weight:bold">(</span>SoundEffectConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">CLICK</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            li<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mOnClickListener</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onClick</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
            result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        sendAccessibilityEvent<span style="color:#000;font-weight:bold">(</span>AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE_VIEW_CLICKED</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

        notifyEnterOrExitForAutoFillIfNeeded<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">return</span> result<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>很明显在sendAccessibilityEvent中将点击事件进行了传递</p>
<blockquote>
<p>所在类:View.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">sendAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> eventType<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mAccessibilityDelegate <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            mAccessibilityDelegate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sendAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> eventType<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
            sendAccessibilityEventInternal<span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//见下
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">sendAccessibilityEventInternal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> eventType<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>AccessibilityManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">(</span>mContext<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isEnabled</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            sendAccessibilityEventUnchecked<span style="color:#000;font-weight:bold">(</span>AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtain</span><span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//见下
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">sendAccessibilityEventUnchecked</span><span style="color:#000;font-weight:bold">(</span>AccessibilityEvent event<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mAccessibilityDelegate <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            mAccessibilityDelegate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sendAccessibilityEventUnchecked</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
            sendAccessibilityEventUncheckedInternal<span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//见下
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
    
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">sendAccessibilityEventUncheckedInternal</span><span style="color:#000;font-weight:bold">(</span>AccessibilityEvent event<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#998;font-style:italic">// Panes disappearing are relevant even if though the view is no longer visible.
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#458;font-weight:bold">boolean</span> isWindowStateChanged <span style="color:#000;font-weight:bold">=</span>
                <span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEventType</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE_WINDOW_STATE_CHANGED</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#458;font-weight:bold">boolean</span> isWindowDisappearedEvent <span style="color:#000;font-weight:bold">=</span> isWindowStateChanged <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getContentChangeTypes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span>
                <span style="color:#000;font-weight:bold">&amp;</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">CONTENT_CHANGE_TYPE_PANE_DISAPPEARED</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>isShown<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">!</span>isWindowDisappearedEvent<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        onInitializeAccessibilityEvent<span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#998;font-style:italic">// Only a subset of accessibility events populates text content.
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEventType</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">&amp;</span> POPULATING_ACCESSIBILITY_EVENT_TYPES<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            dispatchPopulateAccessibilityEvent<span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#998;font-style:italic">// In the beginning we called #isShown(), so we know that getParent() is not null.
</span><span style="color:#998;font-style:italic"></span>        ViewParent parent <span style="color:#000;font-weight:bold">=</span> getParent<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>parent <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            getParent<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">requestSendAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//重点
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在这里我们看到直接调用了getParent().requestSendAccessibilityEvent(this, event);，对这个事件进行分发。即调用了View的父类进行实现，这里其实有点像双亲委托模型。我们都知道View的最终父类是ViewRootImpl，我们直接ViewRootImpl中去看requestSendAccessibilityEvent的实现</p>
<blockquote>
<p>所在类：ViewRootImpl</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#3c5d5d;font-weight:bold">@Override</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">requestSendAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>View child<span style="color:#000;font-weight:bold">,</span> AccessibilityEvent event<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mView <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> mStopped <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> mPausedForTransition<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#998;font-style:italic">// Immediately flush pending content changed event (if any) to preserve event order
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEventType</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE_WINDOW_CONTENT_CHANGED</span>
                <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> mSendWindowContentChangedAccessibilityEvent <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span>
                <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> mSendWindowContentChangedAccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mSource</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            mSendWindowContentChangedAccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">removeCallbacksAndRun</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#998;font-style:italic">// Intercept accessibility focus events fired by virtual nodes to keep
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// track of accessibility focus position in such nodes.
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> eventType <span style="color:#000;font-weight:bold">=</span> event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEventType</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">switch</span> <span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE_VIEW_ACCESSIBILITY_FOCUSED</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">long</span> sourceNodeId <span style="color:#000;font-weight:bold">=</span> event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSourceNodeId</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> accessibilityViewId <span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityViewId</span><span style="color:#000;font-weight:bold">(</span>
                        sourceNodeId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                View source <span style="color:#000;font-weight:bold">=</span> mView<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findViewByAccessibilityId</span><span style="color:#000;font-weight:bold">(</span>accessibilityViewId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>source <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    AccessibilityNodeProvider provider <span style="color:#000;font-weight:bold">=</span> source<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityNodeProvider</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>provider <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> virtualNodeId <span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getVirtualDescendantId</span><span style="color:#000;font-weight:bold">(</span>
                                sourceNodeId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">final</span> AccessibilityNodeInfo node<span style="color:#000;font-weight:bold">;</span>
                        node <span style="color:#000;font-weight:bold">=</span> provider<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createAccessibilityNodeInfo</span><span style="color:#000;font-weight:bold">(</span>virtualNodeId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        setAccessibilityFocus<span style="color:#000;font-weight:bold">(</span>source<span style="color:#000;font-weight:bold">,</span> node<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE_VIEW_ACCESSIBILITY_FOCUS_CLEARED</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">long</span> sourceNodeId <span style="color:#000;font-weight:bold">=</span> event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSourceNodeId</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> accessibilityViewId <span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityViewId</span><span style="color:#000;font-weight:bold">(</span>
                        sourceNodeId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                View source <span style="color:#000;font-weight:bold">=</span> mView<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findViewByAccessibilityId</span><span style="color:#000;font-weight:bold">(</span>accessibilityViewId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>source <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    AccessibilityNodeProvider provider <span style="color:#000;font-weight:bold">=</span> source<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityNodeProvider</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>provider <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        setAccessibilityFocus<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>


            <span style="color:#000;font-weight:bold">case</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE_WINDOW_CONTENT_CHANGED</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                handleWindowContentChangedEvent<span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        mAccessibilityManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sendAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//重点
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>最后在requestSendAccessibilityEvent里面调用mAccessibilityManager.sendAccessibilityEvent继续将点击事件进行分发。</p>
<p>小结:
<img src="/image/Android/11_0.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NDk5ODU5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2accessibilitymanager">2.AccessibilityManager</h4>
<p>从AS跳转到AccessibilityManager.sendAccessibilityEvent，发现sendAccessibilityEvent是一个空实现，不应该啊，然后我就去打开Source Insight 4.0，在里面阅读AccessibilityManager的相关源码.
源码版本:<strong>Android8.1</strong></p>
<blockquote>
<p>目录：frameworks\base\core\java\android\view\accessibility\AccessibilityManager.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">sendAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>AccessibilityEvent event<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">final</span> IAccessibilityManager service<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> userId<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>mLock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            service <span style="color:#000;font-weight:bold">=</span> getServiceLocked<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//关键代码
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>service <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>mIsEnabled<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                Looper myLooper <span style="color:#000;font-weight:bold">=</span> Looper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">myLooper</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>myLooper <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> Looper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMainLooper</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> IllegalStateException<span style="color:#000;font-weight:bold">(</span>
                            <span style="color:#d14">&#34;Accessibility off. Did you forget to check that?&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#998;font-style:italic">// If we&#39;re not running on the thread with the main looper, it&#39;s possible for
</span><span style="color:#998;font-style:italic"></span>                    <span style="color:#998;font-style:italic">// the state of accessibility to change between checking isEnabled and
</span><span style="color:#998;font-style:italic"></span>                    <span style="color:#998;font-style:italic">// calling this method. So just log the error rather than throwing the
</span><span style="color:#998;font-style:italic"></span>                    <span style="color:#998;font-style:italic">// exception.
</span><span style="color:#998;font-style:italic"></span>                    Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">e</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;AccessibilityEvent sent with accessibility disabled&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEventType</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">&amp;</span> mRelevantEventTypes<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>DEBUG<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">i</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;Not dispatching irrelevant event: &#34;</span> <span style="color:#000;font-weight:bold">+</span> event
                            <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; that is not among &#34;</span>
                            <span style="color:#000;font-weight:bold">+</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">eventTypeToString</span><span style="color:#000;font-weight:bold">(</span>mRelevantEventTypes<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
            userId <span style="color:#000;font-weight:bold">=</span> mUserId<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setEventTime</span><span style="color:#000;font-weight:bold">(</span>SystemClock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">uptimeMillis</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#998;font-style:italic">// it is possible that this manager is in the same process as the service but
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">// client using it is called through Binder from another process. Example: MMS
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">// app adds a SMS notification and the NotificationManagerService calls this method
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#458;font-weight:bold">long</span> identityToken <span style="color:#000;font-weight:bold">=</span> Binder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">clearCallingIdentity</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            service<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sendAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">,</span> userId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//关键代码
</span><span style="color:#998;font-style:italic"></span>            Binder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">restoreCallingIdentity</span><span style="color:#000;font-weight:bold">(</span>identityToken<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>DEBUG<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">i</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> event <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; sent&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RemoteException re<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">e</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;Error during sending &#34;</span> <span style="color:#000;font-weight:bold">+</span> event <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; &#34;</span><span style="color:#000;font-weight:bold">,</span> re<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
            event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>从上的代码可以看出通过 service.sendAccessibilityEvent，将AccessibilityEvent进行下一步传递。那么我们来分析一下，service是什么类型的对象。</p>
<p>Service的来源</p>
<blockquote>
<p>目录:frameworks\base\core\java\android\view\accessibility\AccessibilityManager.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">private</span> IAccessibilityManager <span style="color:#900;font-weight:bold">getServiceLocked</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mService <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            tryConnectToServiceLocked<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//往下追踪
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">return</span> mService<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">tryConnectToServiceLocked</span><span style="color:#000;font-weight:bold">(</span>IAccessibilityManager service<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>service <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            IBinder iBinder <span style="color:#000;font-weight:bold">=</span> ServiceManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getService</span><span style="color:#000;font-weight:bold">(</span>Context<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACCESSIBILITY_SERVICE</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>iBinder <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
            service <span style="color:#000;font-weight:bold">=</span> IAccessibilityManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Stub</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">asInterface</span><span style="color:#000;font-weight:bold">(</span>iBinder<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">long</span> userStateAndRelevantEvents <span style="color:#000;font-weight:bold">=</span> service<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addClient</span><span style="color:#000;font-weight:bold">(</span>mClient<span style="color:#000;font-weight:bold">,</span> mUserId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            setStateLocked<span style="color:#000;font-weight:bold">(</span>IntPair<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">first</span><span style="color:#000;font-weight:bold">(</span>userStateAndRelevantEvents<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            mRelevantEventTypes <span style="color:#000;font-weight:bold">=</span> IntPair<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">second</span><span style="color:#000;font-weight:bold">(</span>userStateAndRelevantEvents<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            mService <span style="color:#000;font-weight:bold">=</span> service<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RemoteException re<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">e</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;AccessibilityManagerService is dead&#34;</span><span style="color:#000;font-weight:bold">,</span> re<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
 <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> String ACCESSIBILITY_SERVICE <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;accessibility&#34;</span><span style="color:#000;font-weight:bold">;</span>
</code></pre></td></tr></table>
</div>
</div><p>追踪发现 mService其实是一个binder代理类，代表了accessibility的服务。</p>
<p>所以我们直接看AccessibilityManagerService中sendAccessibilityEvent的实现</p>
<blockquote>
<p>目录: frameworks\base\services\accessibility\java\com\android\server\accessibility\AccessibilityManagerService.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#3c5d5d;font-weight:bold">@Override</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">sendAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>AccessibilityEvent event<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> userId<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#458;font-weight:bold">boolean</span> dispatchEvent <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>mLock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
           <span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span>

        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dispatchEvent<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#998;font-style:italic">// Make sure clients receiving this event will be able to get the
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">// current state of the windows as the window manager may be delaying
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">// the computation for performance reasons.
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEventType</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE_WINDOW_STATE_CHANGED</span>
                    <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> mWindowsForAccessibilityCallback <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                WindowManagerInternal wm <span style="color:#000;font-weight:bold">=</span> LocalServices<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getService</span><span style="color:#000;font-weight:bold">(</span>WindowManagerInternal<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                wm<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">computeWindowsForAccessibility</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>mLock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                notifyAccessibilityServicesDelayedLocked<span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">//重点代码
</span><span style="color:#998;font-style:italic"></span>                notifyAccessibilityServicesDelayedLocked<span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>OWN_PROCESS_ID <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> Binder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCallingPid</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">notifyAccessibilityServicesDelayedLocked</span><span style="color:#000;font-weight:bold">(</span>AccessibilityEvent event<span style="color:#000;font-weight:bold">,</span>
            <span style="color:#458;font-weight:bold">boolean</span> isDefault<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            UserState state <span style="color:#000;font-weight:bold">=</span> getCurrentUserStateLocked<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">,</span> count <span style="color:#000;font-weight:bold">=</span> state<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mBoundServices</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">size</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> count<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">+</span><span style="color:#000;font-weight:bold">+</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#998;font-style:italic">//遍历
</span><span style="color:#998;font-style:italic"></span>                Service service <span style="color:#000;font-weight:bold">=</span> state<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mBoundServices</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>i<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>service<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mIsDefault</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> isDefault<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>doesServiceWantEventLocked<span style="color:#000;font-weight:bold">(</span>service<span style="color:#000;font-weight:bold">,</span> event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        service<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">notifyAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>service<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mUsesAccessibilityCache</span>
                            <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">(</span>AccessibilityCache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">CACHE_CRITICAL_EVENTS_MASK</span>
                                <span style="color:#000;font-weight:bold">&amp;</span> event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEventType</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        service<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">notifyAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>IndexOutOfBoundsException oobe<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#998;font-style:italic">// An out of bounds exception can happen if services are going away
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">// as the for loop is running. If that happens, just bail because
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">// there are no more services to notify.
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在notifyAccessibilityServicesDelayedLocked方法中，对所有存储在mBoundServices的Service进行遍历，并调用Service.notifyAccessibilityEvent。这里的Service是AccessibilityManagerService中的一个内部类。
先看看Service的定义</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Service</span> <span style="color:#000;font-weight:bold">extends</span> IAccessibilityServiceConnection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Stub</span>
            <span style="color:#000;font-weight:bold">implements</span> ServiceConnection<span style="color:#000;font-weight:bold">,</span> DeathRecipient<span style="color:#000;font-weight:bold">,</span> KeyEventDispatcher<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">KeyEventFilter</span><span style="color:#000;font-weight:bold">,</span>
            FingerprintGestureDispatcher<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">FingerprintGestureClient</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span>  	
            <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>IAccessibilityServiceConnection.Stub Aidl接口</li>
<li>ServiceConnection bander连接成功后的回调</li>
<li>aidl的内容可以参考之前博客：<a href="https://blog.csdn.net/qq_38499859/article/details/83628496">Android之IPC2————AIDL</a></li>
</ul>
<blockquote>
<p>目录: frameworks\base\services\accessibility\java\com\android\server\accessibility\AccessibilityManagerService.java#Service</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">notifyAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>AccessibilityEvent event<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">boolean</span> serviceWantsEvent<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>mLock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> eventType <span style="color:#000;font-weight:bold">=</span> event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEventType</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#998;font-style:italic">// Make a copy since during dispatch it is possible the event to
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">// be modified to remove its source if the receiving service does
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">// not have permission to access the window content.
</span><span style="color:#998;font-style:italic"></span>                AccessibilityEvent newEvent <span style="color:#000;font-weight:bold">=</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtain</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                Message message<span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>mNotificationTimeout <span style="color:#000;font-weight:bold">&gt;</span> 0<span style="color:#000;font-weight:bold">)</span>
                        <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">(</span>eventType <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE_WINDOW_CONTENT_CHANGED</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#998;font-style:italic">// Allow at most one pending event
</span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">final</span> AccessibilityEvent oldEvent <span style="color:#000;font-weight:bold">=</span> mPendingEvents<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    mPendingEvents<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">,</span> newEvent<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>oldEvent <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        mEventDispatchHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">removeMessages</span><span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        oldEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                    message <span style="color:#000;font-weight:bold">=</span> mEventDispatchHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtainMessage</span><span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#998;font-style:italic">// Send all messages, bypassing mPendingEvents
</span><span style="color:#998;font-style:italic"></span>                    message <span style="color:#000;font-weight:bold">=</span> mEventDispatchHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtainMessage</span><span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">,</span> newEvent<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
                message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span> <span style="color:#000;font-weight:bold">=</span> serviceWantsEvent <span style="color:#000;font-weight:bold">?</span> 1 <span style="color:#000;font-weight:bold">:</span> 0<span style="color:#000;font-weight:bold">;</span>

                mEventDispatchHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sendMessageDelayed</span><span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">,</span> mNotificationTimeout<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//在Handler里进行处理
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> Handler mEventDispatchHandler <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Handler<span style="color:#000;font-weight:bold">(</span>mMainHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getLooper</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">handleMessage</span><span style="color:#000;font-weight:bold">(</span>Message message<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> eventType <span style="color:#000;font-weight:bold">=</span>  message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">what</span><span style="color:#000;font-weight:bold">;</span>
                AccessibilityEvent event <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>AccessibilityEvent<span style="color:#000;font-weight:bold">)</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obj</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#458;font-weight:bold">boolean</span> serviceWantsEvent <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span>
                notifyAccessibilityEventInternal<span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">,</span> event<span style="color:#000;font-weight:bold">,</span> serviceWantsEvent<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
        
        <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">         * Notifies an accessibility service client for a scheduled event given the event type.
</span><span style="color:#998;font-style:italic">         *
</span><span style="color:#998;font-style:italic">         * @param eventType The type of the event to dispatch.
</span><span style="color:#998;font-style:italic">         */</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">notifyAccessibilityEventInternal</span><span style="color:#000;font-weight:bold">(</span>
                <span style="color:#458;font-weight:bold">int</span> eventType<span style="color:#000;font-weight:bold">,</span>
                AccessibilityEvent event<span style="color:#000;font-weight:bold">,</span>
                <span style="color:#458;font-weight:bold">boolean</span> serviceWantsEvent<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            IAccessibilityServiceClient listener<span style="color:#000;font-weight:bold">;</span>

            <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>mLock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                listener <span style="color:#000;font-weight:bold">=</span> mServiceInterface<span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>listener <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>event <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    event <span style="color:#000;font-weight:bold">=</span> mPendingEvents<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>event <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                    mPendingEvents<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">remove</span><span style="color:#000;font-weight:bold">(</span>eventType<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mSecurityPolicy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">canRetrieveWindowContentLocked</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setConnectionId</span><span style="color:#000;font-weight:bold">(</span>mId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                    event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSource</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>View<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
                event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSealed</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                listener<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">,</span> serviceWantsEvent<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//重点
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>DEBUG<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    Slog<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">i</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;Event &#34;</span> <span style="color:#000;font-weight:bold">+</span> event <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; sent to &#34;</span> <span style="color:#000;font-weight:bold">+</span> listener<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RemoteException re<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                Slog<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">e</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;Error during sending &#34;</span> <span style="color:#000;font-weight:bold">+</span> event <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; to &#34;</span> <span style="color:#000;font-weight:bold">+</span> listener<span style="color:#000;font-weight:bold">,</span> re<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
                event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>继续最终追踪一下mServiceInterface的来源。
通过全局搜索，发现在onServiceConnected里面，完成的mServiceInterface，即binder连接成功后的回调</p>
<blockquote>
<p>目录: frameworks\base\services\accessibility\java\com\android\server\accessibility\AccessibilityManagerService.java#Service</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onServiceConnected</span><span style="color:#000;font-weight:bold">(</span>ComponentName componentName<span style="color:#000;font-weight:bold">,</span> IBinder service<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>mLock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mService <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> service<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mService <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        mService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">unlinkToDeath</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                    mService <span style="color:#000;font-weight:bold">=</span> service<span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                        mService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">linkToDeath</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RemoteException re<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        Slog<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">e</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;Failed registering death link&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        binderDied<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>
                mServiceInterface <span style="color:#000;font-weight:bold">=</span> IAccessibilityServiceClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Stub</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">asInterface</span><span style="color:#000;font-weight:bold">(</span>service<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">//被赋值
</span><span style="color:#998;font-style:italic"></span>                UserState userState <span style="color:#000;font-weight:bold">=</span> getUserStateLocked<span style="color:#000;font-weight:bold">(</span>mUserId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                addServiceLocked<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> userState<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>userState<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mBindingServices</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">contains</span><span style="color:#000;font-weight:bold">(</span>mComponentName<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> mWasConnectedAndDied<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    userState<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mBindingServices</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">remove</span><span style="color:#000;font-weight:bold">(</span>mComponentName<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    mWasConnectedAndDied <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
                    onUserStateChangedLocked<span style="color:#000;font-weight:bold">(</span>userState<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#998;font-style:italic">// Initialize the service on the main handler after we&#39;re done setting up for
</span><span style="color:#998;font-style:italic"></span>                    <span style="color:#998;font-style:italic">// the new configuration (for example, initializing the input filter).
</span><span style="color:#998;font-style:italic"></span>                    mMainHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtainMessage</span><span style="color:#000;font-weight:bold">(</span>MainHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">MSG_INIT_SERVICE</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sendToTarget</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                    binderDied<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们注意一下，mServiceInterface的类型是IAccessibilityServiceClient。这个后面会用。</p>
<p>小结：</p>
<p><img src="/image/Android/11_1.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NDk5ODU5,size_16,color_FFFFFF,t_70" alt="  "></p>
<h4 id="3accessibilityservice">3.AccessibilityService</h4>
<p>前面分析从View到IAccessibilityServiceClient的过程，但是对于IAccessibilityServiceClient的实现。我一直没有找到，然后就回过同从AccessibilityService 重新分析。</p>
<p>AccessibilityService是继承的Service类，只不过它实现了onBind</p>
<blockquote>
<p>目录： frameworks\base\core\java\android\accessibilityservice\AccessibilityService.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">abstract</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AccessibilityService</span> <span style="color:#000;font-weight:bold">extends</span> Service <span style="color:#000;font-weight:bold">{</span>
<span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span>
<span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * Implement to return the implementation of the internal accessibility
</span><span style="color:#998;font-style:italic">     * service interface.
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">final</span> IBinder <span style="color:#900;font-weight:bold">onBind</span><span style="color:#000;font-weight:bold">(</span>Intent intent<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> IAccessibilityServiceClientWrapper<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> getMainLooper<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> Callbacks<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onServiceConnected</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">dispatchServiceConnected</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onInterrupt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onInterrupt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>AccessibilityEvent event<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">init</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> connectionId<span style="color:#000;font-weight:bold">,</span> IBinder windowToken<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                mConnectionId <span style="color:#000;font-weight:bold">=</span> connectionId<span style="color:#000;font-weight:bold">;</span>
                mWindowToken <span style="color:#000;font-weight:bold">=</span> windowToken<span style="color:#000;font-weight:bold">;</span>

                <span style="color:#998;font-style:italic">// The client may have already obtained the window manager, so
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">// update the default token on whatever manager we gave them.
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">final</span> WindowManagerImpl wm <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>WindowManagerImpl<span style="color:#000;font-weight:bold">)</span> getSystemService<span style="color:#000;font-weight:bold">(</span>WINDOW_SERVICE<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                wm<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setDefaultToken</span><span style="color:#000;font-weight:bold">(</span>windowToken<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">onGesture</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> gestureId<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">return</span> AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onGesture</span><span style="color:#000;font-weight:bold">(</span>gestureId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">onKeyEvent</span><span style="color:#000;font-weight:bold">(</span>KeyEvent event<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">return</span> AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onKeyEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onMagnificationChanged</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@NonNull</span> Region region<span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#458;font-weight:bold">float</span> scale<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">float</span> centerX<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">float</span> centerY<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onMagnificationChanged</span><span style="color:#000;font-weight:bold">(</span>region<span style="color:#000;font-weight:bold">,</span> scale<span style="color:#000;font-weight:bold">,</span> centerX<span style="color:#000;font-weight:bold">,</span> centerY<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onSoftKeyboardShowModeChanged</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> showMode<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onSoftKeyboardShowModeChanged</span><span style="color:#000;font-weight:bold">(</span>showMode<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onPerformGestureResult</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> sequence<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">boolean</span> completedSuccessfully<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onPerformGestureResult</span><span style="color:#000;font-weight:bold">(</span>sequence<span style="color:#000;font-weight:bold">,</span> completedSuccessfully<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onFingerprintCapturingGesturesChanged</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">boolean</span> active<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onFingerprintCapturingGesturesChanged</span><span style="color:#000;font-weight:bold">(</span>active<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onFingerprintGesture</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> gesture<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onFingerprintGesture</span><span style="color:#000;font-weight:bold">(</span>gesture<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onAccessibilityButtonClicked</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onAccessibilityButtonClicked</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>

            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onAccessibilityButtonAvailabilityChanged</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">boolean</span> available<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                AccessibilityService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onAccessibilityButtonAvailabilityChanged</span><span style="color:#000;font-weight:bold">(</span>available<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>继续看看IAccessibilityServiceClientWrapper这个内部类</p>
<blockquote>
<p>目录： frameworks\base\core\java\android\accessibilityservice\AccessibilityService#IAccessibilityServiceClientWrapper</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
 <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">IAccessibilityServiceClientWrapper</span> <span style="color:#000;font-weight:bold">extends</span> IAccessibilityServiceClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Stub</span>
            <span style="color:#000;font-weight:bold">implements</span> HandlerCaller<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Callback</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">IAccessibilityServiceClientWrapper</span><span style="color:#000;font-weight:bold">(</span>Context context<span style="color:#000;font-weight:bold">,</span> Looper looper<span style="color:#000;font-weight:bold">,</span>
                Callbacks callback<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            mCallback <span style="color:#000;font-weight:bold">=</span> callback<span style="color:#000;font-weight:bold">;</span>
            mCaller <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HandlerCaller<span style="color:#000;font-weight:bold">(</span>context<span style="color:#000;font-weight:bold">,</span> looper<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">true</span> <span style="color:#998;font-style:italic">/*asyncHandler*/</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">init</span><span style="color:#000;font-weight:bold">(</span>IAccessibilityServiceConnection connection<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> connectionId<span style="color:#000;font-weight:bold">,</span>
                IBinder windowToken<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            Message message <span style="color:#000;font-weight:bold">=</span> mCaller<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtainMessageIOO</span><span style="color:#000;font-weight:bold">(</span>DO_INIT<span style="color:#000;font-weight:bold">,</span> connectionId<span style="color:#000;font-weight:bold">,</span>
                    connection<span style="color:#000;font-weight:bold">,</span> windowToken<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            mCaller<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sendMessage</span><span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>


        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>AccessibilityEvent event<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">boolean</span> serviceWantsEvent<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            Message message <span style="color:#000;font-weight:bold">=</span> mCaller<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtainMessageBO</span><span style="color:#000;font-weight:bold">(</span>
                    DO_ON_ACCESSIBILITY_EVENT<span style="color:#000;font-weight:bold">,</span> serviceWantsEvent<span style="color:#000;font-weight:bold">,</span> event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            mCaller<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sendMessage</span><span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">executeMessage</span><span style="color:#000;font-weight:bold">(</span>Message message<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">switch</span> <span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">what</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">case</span> DO_ON_ACCESSIBILITY_EVENT<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    AccessibilityEvent event <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>AccessibilityEvent<span style="color:#000;font-weight:bold">)</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obj</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#458;font-weight:bold">boolean</span> serviceWantsEvent <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>event <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#998;font-style:italic">// Send the event to AccessibilityCache via AccessibilityInteractionClient
</span><span style="color:#998;font-style:italic"></span>                        AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>serviceWantsEvent
                                <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            <span style="color:#998;font-style:italic">// Send the event to AccessibilityService
</span><span style="color:#998;font-style:italic"></span>                            mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onAccessibilityEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">}</span>
                        <span style="color:#998;font-style:italic">// Make sure the event is recycled.
</span><span style="color:#998;font-style:italic"></span>                        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                            event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>IllegalStateException ise<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            <span style="color:#998;font-style:italic">/* ignore - best effort */</span>
                        <span style="color:#000;font-weight:bold">}</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> DO_ON_INTERRUPT<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onInterrupt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> DO_INIT<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    mConnectionId <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>
                    SomeArgs args <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SomeArgs<span style="color:#000;font-weight:bold">)</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obj</span><span style="color:#000;font-weight:bold">;</span>
                    IAccessibilityServiceConnection connection <span style="color:#000;font-weight:bold">=</span>
                            <span style="color:#000;font-weight:bold">(</span>IAccessibilityServiceConnection<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>
                    IBinder windowToken <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>IBinder<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg2</span><span style="color:#000;font-weight:bold">;</span>
                    args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>connection <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addConnection</span><span style="color:#000;font-weight:bold">(</span>mConnectionId<span style="color:#000;font-weight:bold">,</span>
                                connection<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">init</span><span style="color:#000;font-weight:bold">(</span>mConnectionId<span style="color:#000;font-weight:bold">,</span> windowToken<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onServiceConnected</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                        AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">removeConnection</span><span style="color:#000;font-weight:bold">(</span>
                                mConnectionId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        mConnectionId <span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">;</span>
                        AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">clearCache</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">init</span><span style="color:#000;font-weight:bold">(</span>AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> DO_ON_GESTURE<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> gestureId <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onGesture</span><span style="color:#000;font-weight:bold">(</span>gestureId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> DO_CLEAR_ACCESSIBILITY_CACHE<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">clearCache</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> DO_ON_KEY_EVENT<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    KeyEvent event <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>KeyEvent<span style="color:#000;font-weight:bold">)</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obj</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                        IAccessibilityServiceConnection connection <span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient
                                <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">(</span>mConnectionId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>connection <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">boolean</span> result <span style="color:#000;font-weight:bold">=</span> mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onKeyEvent</span><span style="color:#000;font-weight:bold">(</span>event<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                            <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> sequence <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>
                            <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                                connection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setOnKeyEventResult</span><span style="color:#000;font-weight:bold">(</span>result<span style="color:#000;font-weight:bold">,</span> sequence<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RemoteException re<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                                <span style="color:#998;font-style:italic">/* ignore */</span>
                            <span style="color:#000;font-weight:bold">}</span>
                        <span style="color:#000;font-weight:bold">}</span>
                    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#998;font-style:italic">// Make sure the event is recycled.
</span><span style="color:#998;font-style:italic"></span>                        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                            event<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>IllegalStateException ise<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            <span style="color:#998;font-style:italic">/* ignore - best effort */</span>
                        <span style="color:#000;font-weight:bold">}</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> DO_ON_MAGNIFICATION_CHANGED<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">final</span> SomeArgs args <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SomeArgs<span style="color:#000;font-weight:bold">)</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obj</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">final</span> Region region <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>Region<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">float</span> scale <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">float</span><span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg2</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">float</span> centerX <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">float</span><span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg3</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">float</span> centerY <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">float</span><span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg4</span><span style="color:#000;font-weight:bold">;</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onMagnificationChanged</span><span style="color:#000;font-weight:bold">(</span>region<span style="color:#000;font-weight:bold">,</span> scale<span style="color:#000;font-weight:bold">,</span> centerX<span style="color:#000;font-weight:bold">,</span> centerY<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> DO_ON_SOFT_KEYBOARD_SHOW_MODE_CHANGED<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> showMode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onSoftKeyboardShowModeChanged</span><span style="color:#000;font-weight:bold">(</span>showMode<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> DO_GESTURE_COMPLETE<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">boolean</span> successfully <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg2</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> 1<span style="color:#000;font-weight:bold">;</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onPerformGestureResult</span><span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">,</span> successfully<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> DO_ON_FINGERPRINT_ACTIVE_CHANGED<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onFingerprintCapturingGesturesChanged</span><span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> 1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> DO_ON_FINGERPRINT_GESTURE<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onFingerprintGesture</span><span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> <span style="color:#000;font-weight:bold">(</span>DO_ACCESSIBILITY_BUTTON_CLICKED<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onAccessibilityButtonClicked</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">case</span> <span style="color:#000;font-weight:bold">(</span>DO_ACCESSIBILITY_BUTTON_AVAILABILITY_CHANGED<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mConnectionId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NO_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">boolean</span> available <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        mCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onAccessibilityButtonAvailabilityChanged</span><span style="color:#000;font-weight:bold">(</span>available<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">default</span> <span style="color:#000;font-weight:bold">:</span>
                    Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">w</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;Unknown message type &#34;</span> <span style="color:#000;font-weight:bold">+</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">what</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在这里我们找到了IAccessibilityServiceClient.Stub。</p>
<p>所以可知，在AccessibilityService中，当AccessibilityManagerService和建立连接后，获得onBind返回的IAccessibilityServiceClientWrapper，在onServiceConnected回调中，将IAccessibilityServiceClientWrapper赋值给我们上面说的mServiceInterface。</p>
<h3 id="三findaccessibilitynodeinfosbytext">三.findAccessibilityNodeInfosByText</h3>
<h4 id="1accessibilitynodeinfo">1.AccessibilityNodeInfo</h4>
<p>上面分析了点击事件是如何通知给AccessibilityService，现在让我们来看看AccessibilityService是如何选择的对应的控件的，以findAccessibilityNodeInfosByText为例</p>
<blockquote>
<p>目录:frameworks\base\core\java\android\view\accessibility\AccessibilityNodeInfo.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>AccessibilityNodeInfo<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">findAccessibilityNodeInfosByText</span><span style="color:#000;font-weight:bold">(</span>String text<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        enforceSealed<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>canPerformRequestOverConnection<span style="color:#000;font-weight:bold">(</span>mSourceNodeId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> Collections<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">emptyList</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        AccessibilityInteractionClient client <span style="color:#000;font-weight:bold">=</span> AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">return</span> client<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAccessibilityNodeInfosByText</span><span style="color:#000;font-weight:bold">(</span>mConnectionId<span style="color:#000;font-weight:bold">,</span> mWindowId<span style="color:#000;font-weight:bold">,</span> mSourceNodeId<span style="color:#000;font-weight:bold">,</span>
                text<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

</code></pre></td></tr></table>
</div>
</div><p>继续追踪AccessibilityInteractionClient.findAccessibilityNodeInfosByText</p>
<blockquote>
<p>目录:frameworks\base\core\java\android\view\accessibility\AccessibilityInteractionClient.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>AccessibilityNodeInfo<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">findAccessibilityNodeInfosByText</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> connectionId<span style="color:#000;font-weight:bold">,</span>
            <span style="color:#458;font-weight:bold">int</span> accessibilityWindowId<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">long</span> accessibilityNodeId<span style="color:#000;font-weight:bold">,</span> String text<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            IAccessibilityServiceConnection connection <span style="color:#000;font-weight:bold">=</span> getConnection<span style="color:#000;font-weight:bold">(</span>connectionId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>connection <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> interactionId <span style="color:#000;font-weight:bold">=</span> mInteractionIdCounter<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAndIncrement</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">long</span> identityToken <span style="color:#000;font-weight:bold">=</span> Binder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">clearCallingIdentity</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">boolean</span> success <span style="color:#000;font-weight:bold">=</span> connection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAccessibilityNodeInfosByText</span><span style="color:#000;font-weight:bold">(</span>
                        accessibilityWindowId<span style="color:#000;font-weight:bold">,</span> accessibilityNodeId<span style="color:#000;font-weight:bold">,</span> text<span style="color:#000;font-weight:bold">,</span> interactionId<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span>
                        Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">currentThread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">//重点
</span><span style="color:#998;font-style:italic"></span>                Binder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">restoreCallingIdentity</span><span style="color:#000;font-weight:bold">(</span>identityToken<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>success<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    List<span style="color:#000;font-weight:bold">&lt;</span>AccessibilityNodeInfo<span style="color:#000;font-weight:bold">&gt;</span> infos <span style="color:#000;font-weight:bold">=</span> getFindAccessibilityNodeInfosResultAndClear<span style="color:#000;font-weight:bold">(</span>
                            interactionId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>infos <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        finalizeAndCacheAccessibilityNodeInfos<span style="color:#000;font-weight:bold">(</span>infos<span style="color:#000;font-weight:bold">,</span> connectionId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                        <span style="color:#000;font-weight:bold">return</span> infos<span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>DEBUG<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">w</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;No connection for connection id: &#34;</span> <span style="color:#000;font-weight:bold">+</span> connectionId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RemoteException re<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">w</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;Error while calling remote&#34;</span>
                    <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; findAccessibilityNodeInfosByViewText&#34;</span><span style="color:#000;font-weight:bold">,</span> re<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">return</span> Collections<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">emptyList</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span> 
</code></pre></td></tr></table>
</div>
</div><p>这里出现了IAccessibilityServiceConnection类型，他是在哪定义的呢？其实我们在上一节中，有分析过这个内容，它其实就是AccessibilityManagerService中的内部类Service。</p>
<p>上面这个过程也是通过Binder完成的IPC</p>
<h4 id="2accessibilitymanagerservice">2.AccessibilityManagerService</h4>
<p>我们继续分析AccessibilityManagerService中的内部类Service中的实现</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Service</span> <span style="color:#000;font-weight:bold">extends</span> IAccessibilityServiceConnection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Stub</span>
            <span style="color:#000;font-weight:bold">implements</span> ServiceConnection<span style="color:#000;font-weight:bold">,</span> DeathRecipient<span style="color:#000;font-weight:bold">,</span> KeyEventDispatcher<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">KeyEventFilter</span><span style="color:#000;font-weight:bold">,</span>
            FingerprintGestureDispatcher<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">FingerprintGestureClient</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>目录&rdquo; frameworks\base\services\accessibility\java\com\android\server\accessibility\AccessibilityManagerService.java#Service</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">findAccessibilityNodeInfosByText</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> accessibilityWindowId<span style="color:#000;font-weight:bold">,</span>
                <span style="color:#458;font-weight:bold">long</span> accessibilityNodeId<span style="color:#000;font-weight:bold">,</span> String text<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> interactionId<span style="color:#000;font-weight:bold">,</span>
                IAccessibilityInteractionConnectionCallback callback<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">long</span> interrogatingTid<span style="color:#000;font-weight:bold">)</span>
                <span style="color:#000;font-weight:bold">throws</span> RemoteException <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> resolvedWindowId<span style="color:#000;font-weight:bold">;</span>
            IAccessibilityInteractionConnection connection <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
            Region partialInteractiveRegion <span style="color:#000;font-weight:bold">=</span> Region<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtain</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            MagnificationSpec spec<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>mLock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                mUsesAccessibilityCache <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>isCalledForCurrentUserLocked<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
                resolvedWindowId <span style="color:#000;font-weight:bold">=</span> resolveAccessibilityWindowIdLocked<span style="color:#000;font-weight:bold">(</span>accessibilityWindowId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">boolean</span> permissionGranted <span style="color:#000;font-weight:bold">=</span>
                    mSecurityPolicy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">canGetAccessibilityNodeInfoLocked</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> resolvedWindowId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>permissionGranted<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                    connection <span style="color:#000;font-weight:bold">=</span> getConnectionLocked<span style="color:#000;font-weight:bold">(</span>resolvedWindowId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>connection <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>mSecurityPolicy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">computePartialInteractiveRegionForWindowLocked</span><span style="color:#000;font-weight:bold">(</span>
                        resolvedWindowId<span style="color:#000;font-weight:bold">,</span> partialInteractiveRegion<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    partialInteractiveRegion<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    partialInteractiveRegion <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
                spec <span style="color:#000;font-weight:bold">=</span> getCompatibleMagnificationSpecLocked<span style="color:#000;font-weight:bold">(</span>resolvedWindowId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> interrogatingPid <span style="color:#000;font-weight:bold">=</span> Binder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCallingPid</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            callback <span style="color:#000;font-weight:bold">=</span> replaceCallbackIfNeeded<span style="color:#000;font-weight:bold">(</span>callback<span style="color:#000;font-weight:bold">,</span> resolvedWindowId<span style="color:#000;font-weight:bold">,</span> interactionId<span style="color:#000;font-weight:bold">,</span>
                    interrogatingPid<span style="color:#000;font-weight:bold">,</span> interrogatingTid<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">long</span> identityToken <span style="color:#000;font-weight:bold">=</span> Binder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">clearCallingIdentity</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                connection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAccessibilityNodeInfosByText</span><span style="color:#000;font-weight:bold">(</span>accessibilityNodeId<span style="color:#000;font-weight:bold">,</span> text<span style="color:#000;font-weight:bold">,</span>
                        partialInteractiveRegion<span style="color:#000;font-weight:bold">,</span> interactionId<span style="color:#000;font-weight:bold">,</span> callback<span style="color:#000;font-weight:bold">,</span> mFetchFlags<span style="color:#000;font-weight:bold">,</span>
                        interrogatingPid<span style="color:#000;font-weight:bold">,</span> interrogatingTid<span style="color:#000;font-weight:bold">,</span> spec<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">//重点代码
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RemoteException re<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>DEBUG<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    Slog<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">e</span><span style="color:#000;font-weight:bold">(</span>LOG_TAG<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;Error calling findAccessibilityNodeInfosByText()&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
                Binder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">restoreCallingIdentity</span><span style="color:#000;font-weight:bold">(</span>identityToken<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#998;font-style:italic">// Recycle if passed to another process.
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>partialInteractiveRegion <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> Binder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isProxy</span><span style="color:#000;font-weight:bold">(</span>connection<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    partialInteractiveRegion<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

</code></pre></td></tr></table>
</div>
</div><p>这里又出现一个connection，类型是IAccessibilityInteractionConnection。这个我找了半天，后来通过上面一节内容。我猜测是在ViewRootImpl中，最后搜索了一些。果然是在ViewRootImpl中实现的</p>
<h4 id="3viewrootimpl">3.ViewRootImpl</h4>
<p>我们继续来看ViewRootImpl中的实现</p>
<blockquote>
<p>目录:\frameworks\base\core\java\android\view\ViewRootImpl.java</p>
</blockquote>
<p>AccessibilityInteractionConnection内部类定义</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AccessibilityInteractionConnection</span>
            <span style="color:#000;font-weight:bold">extends</span> IAccessibilityInteractionConnection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Stub</span> <span style="color:#000;font-weight:bold">{</span>
<span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>findAccessibilityNodeInfosByText的实现</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">findAccessibilityNodeInfosByText</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">long</span> accessibilityNodeId<span style="color:#000;font-weight:bold">,</span> String text<span style="color:#000;font-weight:bold">,</span>
                Region interactiveRegion<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> interactionId<span style="color:#000;font-weight:bold">,</span>
                IAccessibilityInteractionConnectionCallback callback<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> flags<span style="color:#000;font-weight:bold">,</span>
                <span style="color:#458;font-weight:bold">int</span> interrogatingPid<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">long</span> interrogatingTid<span style="color:#000;font-weight:bold">,</span> MagnificationSpec spec<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            ViewRootImpl viewRootImpl <span style="color:#000;font-weight:bold">=</span> mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>viewRootImpl <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> viewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mView</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                viewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityInteractionController</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span>
                    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAccessibilityNodeInfosByTextClientThread</span><span style="color:#000;font-weight:bold">(</span>accessibilityNodeId<span style="color:#000;font-weight:bold">,</span> text<span style="color:#000;font-weight:bold">,</span>
                            interactiveRegion<span style="color:#000;font-weight:bold">,</span> interactionId<span style="color:#000;font-weight:bold">,</span> callback<span style="color:#000;font-weight:bold">,</span> flags<span style="color:#000;font-weight:bold">,</span> interrogatingPid<span style="color:#000;font-weight:bold">,</span>
                            interrogatingTid<span style="color:#000;font-weight:bold">,</span> spec<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#998;font-style:italic">// We cannot make the call and notify the caller so it does not wait.
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    callback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setFindAccessibilityNodeInfosResult</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> interactionId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RemoteException re<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#998;font-style:italic">/* best effort - ignore */</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>viewRootImpl.getAccessibilityInteractionController() 返回的是AccessibilityInteractionController,我们看看</p>
<blockquote>
<p>目录:frameworks\base\core\java\android\view\AccessibilityInteractionController.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">     <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">findAccessibilityNodeInfosByTextClientThread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">long</span> accessibilityNodeId<span style="color:#000;font-weight:bold">,</span>
            String text<span style="color:#000;font-weight:bold">,</span> Region interactiveRegion<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> interactionId<span style="color:#000;font-weight:bold">,</span>
            IAccessibilityInteractionConnectionCallback callback<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> flags<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> interrogatingPid<span style="color:#000;font-weight:bold">,</span>
            <span style="color:#458;font-weight:bold">long</span> interrogatingTid<span style="color:#000;font-weight:bold">,</span> MagnificationSpec spec<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        Message message <span style="color:#000;font-weight:bold">=</span> mHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtainMessage</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">what</span> <span style="color:#000;font-weight:bold">=</span> PrivateHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_TEXT</span><span style="color:#000;font-weight:bold">;</span>
        message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span> <span style="color:#000;font-weight:bold">=</span> flags<span style="color:#000;font-weight:bold">;</span>

        SomeArgs args <span style="color:#000;font-weight:bold">=</span> SomeArgs<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtain</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span> <span style="color:#000;font-weight:bold">=</span> text<span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg2</span> <span style="color:#000;font-weight:bold">=</span> callback<span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg3</span> <span style="color:#000;font-weight:bold">=</span> spec<span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi1</span> <span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityViewId</span><span style="color:#000;font-weight:bold">(</span>accessibilityNodeId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi2</span> <span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getVirtualDescendantId</span><span style="color:#000;font-weight:bold">(</span>accessibilityNodeId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi3</span> <span style="color:#000;font-weight:bold">=</span> interactionId<span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg4</span> <span style="color:#000;font-weight:bold">=</span> interactiveRegion<span style="color:#000;font-weight:bold">;</span>
        message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obj</span> <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">;</span>

        scheduleMessage<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">,</span> interrogatingPid<span style="color:#000;font-weight:bold">,</span> interrogatingTid<span style="color:#000;font-weight:bold">,</span> CONSIDER_REQUEST_PREPARERS<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">//追踪
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">}</span>
    
    
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">scheduleMessage</span><span style="color:#000;font-weight:bold">(</span>Message message<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> interrogatingPid<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">long</span> interrogatingTid<span style="color:#000;font-weight:bold">,</span>
           <span style="color:#458;font-weight:bold">boolean</span> ignoreRequestPreparers<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
       <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>ignoreRequestPreparers
               <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> <span style="color:#000;font-weight:bold">!</span>holdOffMessageIfNeeded<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">,</span> interrogatingPid<span style="color:#000;font-weight:bold">,</span> interrogatingTid<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
           <span style="color:#998;font-style:italic">// If the interrogation is performed by the same thread as the main UI
</span><span style="color:#998;font-style:italic"></span>           <span style="color:#998;font-style:italic">// thread in this process, set the message as a static reference so
</span><span style="color:#998;font-style:italic"></span>           <span style="color:#998;font-style:italic">// after this call completes the same thread but in the interrogating
</span><span style="color:#998;font-style:italic"></span>           <span style="color:#998;font-style:italic">// client can handle the message to generate the result.
</span><span style="color:#998;font-style:italic"></span>           <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>interrogatingPid <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> mMyProcessId <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> interrogatingTid <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> mMyLooperThreadId<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
               AccessibilityInteractionClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstanceForThread</span><span style="color:#000;font-weight:bold">(</span>
                       interrogatingTid<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSameThreadMessage</span><span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
           <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
               mHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sendMessage</span><span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">//去handler的实现类
</span><span style="color:#998;font-style:italic"></span>           <span style="color:#000;font-weight:bold">}</span>
       <span style="color:#000;font-weight:bold">}</span>
   <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PrivateHandler</span> <span style="color:#000;font-weight:bold">extends</span> Handler <span style="color:#000;font-weight:bold">{</span>
       <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> MSG_PERFORM_ACCESSIBILITY_ACTION <span style="color:#000;font-weight:bold">=</span> 1<span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_ACCESSIBILITY_ID <span style="color:#000;font-weight:bold">=</span> 2<span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> MSG_FIND_ACCESSIBILITY_NODE_INFOS_BY_VIEW_ID <span style="color:#000;font-weight:bold">=</span> 3<span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_TEXT <span style="color:#000;font-weight:bold">=</span> 4<span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> MSG_FIND_FOCUS <span style="color:#000;font-weight:bold">=</span> 5<span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> MSG_FOCUS_SEARCH <span style="color:#000;font-weight:bold">=</span> 6<span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> MSG_PREPARE_FOR_EXTRA_DATA_REQUEST <span style="color:#000;font-weight:bold">=</span> 7<span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> MSG_APP_PREPARATION_FINISHED <span style="color:#000;font-weight:bold">=</span> 8<span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> MSG_APP_PREPARATION_TIMEOUT <span style="color:#000;font-weight:bold">=</span> 9<span style="color:#000;font-weight:bold">;</span>

       <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">PrivateHandler</span><span style="color:#000;font-weight:bold">(</span>Looper looper<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
           <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">(</span>looper<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">}</span>

       <span style="color:#3c5d5d;font-weight:bold">@Override</span>
       <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">getMessageName</span><span style="color:#000;font-weight:bold">(</span>Message message<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
           <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> type <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">what</span><span style="color:#000;font-weight:bold">;</span>
           <span style="color:#000;font-weight:bold">switch</span> <span style="color:#000;font-weight:bold">(</span>type<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_PERFORM_ACCESSIBILITY_ACTION<span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;MSG_PERFORM_ACCESSIBILITY_ACTION&#34;</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_ACCESSIBILITY_ID<span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_ACCESSIBILITY_ID&#34;</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FIND_ACCESSIBILITY_NODE_INFOS_BY_VIEW_ID<span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;MSG_FIND_ACCESSIBILITY_NODE_INFOS_BY_VIEW_ID&#34;</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_TEXT<span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_TEXT&#34;</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FIND_FOCUS<span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;MSG_FIND_FOCUS&#34;</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FOCUS_SEARCH<span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;MSG_FOCUS_SEARCH&#34;</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_PREPARE_FOR_EXTRA_DATA_REQUEST<span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;MSG_PREPARE_FOR_EXTRA_DATA_REQUEST&#34;</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_APP_PREPARATION_FINISHED<span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;MSG_APP_PREPARATION_FINISHED&#34;</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_APP_PREPARATION_TIMEOUT<span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;MSG_APP_PREPARATION_TIMEOUT&#34;</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">default</span><span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> IllegalArgumentException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Unknown message type: &#34;</span> <span style="color:#000;font-weight:bold">+</span> type<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
           <span style="color:#000;font-weight:bold">}</span>
       <span style="color:#000;font-weight:bold">}</span>

       <span style="color:#3c5d5d;font-weight:bold">@Override</span>
       <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">handleMessage</span><span style="color:#000;font-weight:bold">(</span>Message message<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
           <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> type <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">what</span><span style="color:#000;font-weight:bold">;</span>
           <span style="color:#000;font-weight:bold">switch</span> <span style="color:#000;font-weight:bold">(</span>type<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_ACCESSIBILITY_ID<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                   findAccessibilityNodeInfoByAccessibilityIdUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_PERFORM_ACCESSIBILITY_ACTION<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                   performAccessibilityActionUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FIND_ACCESSIBILITY_NODE_INFOS_BY_VIEW_ID<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                   findAccessibilityNodeInfosByViewIdUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_TEXT<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                   findAccessibilityNodeInfosByTextUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FIND_FOCUS<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                   findFocusUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_FOCUS_SEARCH<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                   focusSearchUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_PREPARE_FOR_EXTRA_DATA_REQUEST<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                   prepareForExtraDataRequestUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_APP_PREPARATION_FINISHED<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                   requestPreparerDoneUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">case</span> MSG_APP_PREPARATION_TIMEOUT<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                   requestPreparerTimeoutUiThread<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">default</span><span style="color:#000;font-weight:bold">:</span>
                   <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> IllegalArgumentException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Unknown message type: &#34;</span> <span style="color:#000;font-weight:bold">+</span> type<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
           <span style="color:#000;font-weight:bold">}</span>
       <span style="color:#000;font-weight:bold">}</span>
   <span style="color:#000;font-weight:bold">}</span>

<span style="color:#998;font-style:italic">//重点代码
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">findAccessibilityNodeInfosByTextUiThread</span><span style="color:#000;font-weight:bold">(</span>Message message<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
       <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> flags <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>

       SomeArgs args <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SomeArgs<span style="color:#000;font-weight:bold">)</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obj</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">final</span> String text <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">final</span> IAccessibilityInteractionConnectionCallback callback <span style="color:#000;font-weight:bold">=</span>
           <span style="color:#000;font-weight:bold">(</span>IAccessibilityInteractionConnectionCallback<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg2</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">final</span> MagnificationSpec spec <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>MagnificationSpec<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg3</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> accessibilityViewId <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi1</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> virtualDescendantId <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi2</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> interactionId <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi3</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">final</span> Region interactiveRegion <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>Region<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg4</span><span style="color:#000;font-weight:bold">;</span>
       args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

       List<span style="color:#000;font-weight:bold">&lt;</span>AccessibilityNodeInfo<span style="color:#000;font-weight:bold">&gt;</span> infos <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
           <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mView</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mAttachInfo</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
               <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
           <span style="color:#000;font-weight:bold">}</span>
           mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mAttachInfo</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mAccessibilityFetchFlags</span> <span style="color:#000;font-weight:bold">=</span> flags<span style="color:#000;font-weight:bold">;</span>
           View root <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
           <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>accessibilityViewId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ROOT_ITEM_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
               root <span style="color:#000;font-weight:bold">=</span> findViewByAccessibilityId<span style="color:#000;font-weight:bold">(</span>accessibilityViewId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
           <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
               root <span style="color:#000;font-weight:bold">=</span> mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mView</span><span style="color:#000;font-weight:bold">;</span>
           <span style="color:#000;font-weight:bold">}</span>
           <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>root <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> isShown<span style="color:#000;font-weight:bold">(</span>root<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
               AccessibilityNodeProvider provider <span style="color:#000;font-weight:bold">=</span> root<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityNodeProvider</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>provider <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                   infos <span style="color:#000;font-weight:bold">=</span> provider<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAccessibilityNodeInfosByText</span><span style="color:#000;font-weight:bold">(</span>text<span style="color:#000;font-weight:bold">,</span>
                           virtualDescendantId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>virtualDescendantId <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> AccessibilityNodeProvider<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">HOST_VIEW_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                   ArrayList<span style="color:#000;font-weight:bold">&lt;</span>View<span style="color:#000;font-weight:bold">&gt;</span> foundViews <span style="color:#000;font-weight:bold">=</span> mTempArrayList<span style="color:#000;font-weight:bold">;</span>
                   foundViews<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">clear</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                   <span style="color:#998;font-style:italic">//重点代码
</span><span style="color:#998;font-style:italic"></span>                   root<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findViewsWithText</span><span style="color:#000;font-weight:bold">(</span>foundViews<span style="color:#000;font-weight:bold">,</span> text<span style="color:#000;font-weight:bold">,</span> View<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">FIND_VIEWS_WITH_TEXT</span>
                           <span style="color:#000;font-weight:bold">|</span> View<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">FIND_VIEWS_WITH_CONTENT_DESCRIPTION</span>
                           <span style="color:#000;font-weight:bold">|</span> View<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">FIND_VIEWS_WITH_ACCESSIBILITY_NODE_PROVIDERS</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                   <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>foundViews<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isEmpty</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                       infos <span style="color:#000;font-weight:bold">=</span> mTempAccessibilityNodeInfoList<span style="color:#000;font-weight:bold">;</span>
                       infos<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">clear</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                       <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> viewCount <span style="color:#000;font-weight:bold">=</span> foundViews<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">size</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                       <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> viewCount<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">+</span><span style="color:#000;font-weight:bold">+</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                           View foundView <span style="color:#000;font-weight:bold">=</span> foundViews<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>i<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                           <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>isShown<span style="color:#000;font-weight:bold">(</span>foundView<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                               provider <span style="color:#000;font-weight:bold">=</span> foundView<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityNodeProvider</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                               <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>provider <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                                   List<span style="color:#000;font-weight:bold">&lt;</span>AccessibilityNodeInfo<span style="color:#000;font-weight:bold">&gt;</span> infosFromProvider <span style="color:#000;font-weight:bold">=</span>
                                       provider<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAccessibilityNodeInfosByText</span><span style="color:#000;font-weight:bold">(</span>text<span style="color:#000;font-weight:bold">,</span>
                                               AccessibilityNodeProvider<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">HOST_VIEW_ID</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                                   <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>infosFromProvider <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                                       infos<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAll</span><span style="color:#000;font-weight:bold">(</span>infosFromProvider<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                                   <span style="color:#000;font-weight:bold">}</span>
                               <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span>  <span style="color:#000;font-weight:bold">{</span>
                                   infos<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>foundView<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createAccessibilityNodeInfo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                               <span style="color:#000;font-weight:bold">}</span>
                           <span style="color:#000;font-weight:bold">}</span>
                       <span style="color:#000;font-weight:bold">}</span>
                   <span style="color:#000;font-weight:bold">}</span>
               <span style="color:#000;font-weight:bold">}</span>
           <span style="color:#000;font-weight:bold">}</span>
       <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
           updateInfosForViewportAndReturnFindNodeResult<span style="color:#000;font-weight:bold">(</span>
                   infos<span style="color:#000;font-weight:bold">,</span> callback<span style="color:#000;font-weight:bold">,</span> interactionId<span style="color:#000;font-weight:bold">,</span> spec<span style="color:#000;font-weight:bold">,</span> interactiveRegion<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
       <span style="color:#000;font-weight:bold">}</span>
   <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在最后 root.findViewsWithText。root的来源是 root = mViewRootImpl.mView。我们知道mViewRootImpl.mView其实是通过setView来赋值的。一般都是ViewGrop类型。我们直接去看ViewGrup的findViewsWithText</p>
<blockquote>
<p>目录:frameworks\base\core\java\android\view\ViewGroup.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">findViewsWithText</span><span style="color:#000;font-weight:bold">(</span>ArrayList<span style="color:#000;font-weight:bold">&lt;</span>View<span style="color:#000;font-weight:bold">&gt;</span> outViews<span style="color:#000;font-weight:bold">,</span> CharSequence text<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> flags<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findViewsWithText</span><span style="color:#000;font-weight:bold">(</span>outViews<span style="color:#000;font-weight:bold">,</span> text<span style="color:#000;font-weight:bold">,</span> flags<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> childrenCount <span style="color:#000;font-weight:bold">=</span> mChildrenCount<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> View<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> children <span style="color:#000;font-weight:bold">=</span> mChildren<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> childrenCount<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">+</span><span style="color:#000;font-weight:bold">+</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            View child <span style="color:#000;font-weight:bold">=</span> children<span style="color:#000;font-weight:bold">[</span>i<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>child<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mViewFlags</span> <span style="color:#000;font-weight:bold">&amp;</span> VISIBILITY_MASK<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> VISIBLE
                    <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">(</span>child<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mPrivateFlags</span> <span style="color:#000;font-weight:bold">&amp;</span> PFLAG_IS_ROOT_NAMESPACE<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                child<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findViewsWithText</span><span style="color:#000;font-weight:bold">(</span>outViews<span style="color:#000;font-weight:bold">,</span> text<span style="color:#000;font-weight:bold">,</span> flags<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>继续看看View的实现</p>
<blockquote>
<p>目录：frameworks\base\core\java\android\view\View.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">findViewsWithText</span><span style="color:#000;font-weight:bold">(</span>ArrayList<span style="color:#000;font-weight:bold">&lt;</span>View<span style="color:#000;font-weight:bold">&gt;</span> outViews<span style="color:#000;font-weight:bold">,</span> CharSequence searched<span style="color:#000;font-weight:bold">,</span>
            <span style="color:#3c5d5d;font-weight:bold">@FindViewFlags</span> <span style="color:#458;font-weight:bold">int</span> flags<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>getAccessibilityNodeProvider<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>flags <span style="color:#000;font-weight:bold">&amp;</span> FIND_VIEWS_WITH_ACCESSIBILITY_NODE_PROVIDERS<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                outViews<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>flags <span style="color:#000;font-weight:bold">&amp;</span> FIND_VIEWS_WITH_CONTENT_DESCRIPTION<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0
                <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">(</span>searched <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> searched<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">&gt;</span> 0<span style="color:#000;font-weight:bold">)</span>
                <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">(</span>mContentDescription <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> mContentDescription<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">&gt;</span> 0<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            String searchedLowerCase <span style="color:#000;font-weight:bold">=</span> searched<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toLowerCase</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            String contentDescriptionLowerCase <span style="color:#000;font-weight:bold">=</span> mContentDescription<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toLowerCase</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>contentDescriptionLowerCase<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">contains</span><span style="color:#000;font-weight:bold">(</span>searchedLowerCase<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                outViews<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

</code></pre></td></tr></table>
</div>
</div><p>至此我们可以看出，最终会调用View的findViewsWithText，将符合条件的View放入到 outViews集合中。</p>
<h4 id="4小结">4.小结</h4>
<p>时序图：
<img src="/image/Android/11_2.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NDk5ODU5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="四performaction">四.performAction</h3>
<p>点击事件和上面查找控件的流程很想，着重分析一下AccessibilityInteractionController之后的流程
<img src="/image/Android/11_3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NDk5ODU5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1accessibilityinteractioncontroller">1.AccessibilityInteractionController</h4>
<p>从performAccessibilityActionClientThread开始分析</p>
<blockquote>
<p>目录:frameworks\base\core\java\android\view\AccessibilityInteractionController.java</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">performAccessibilityActionClientThread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">long</span> accessibilityNodeId<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> action<span style="color:#000;font-weight:bold">,</span>
            Bundle arguments<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> interactionId<span style="color:#000;font-weight:bold">,</span>
            IAccessibilityInteractionConnectionCallback callback<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> flags<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> interrogatingPid<span style="color:#000;font-weight:bold">,</span>
            <span style="color:#458;font-weight:bold">long</span> interrogatingTid<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        Message message <span style="color:#000;font-weight:bold">=</span> mHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtainMessage</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">what</span> <span style="color:#000;font-weight:bold">=</span> PrivateHandler<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">MSG_PERFORM_ACCESSIBILITY_ACTION</span><span style="color:#000;font-weight:bold">;</span>
        message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span> <span style="color:#000;font-weight:bold">=</span> flags<span style="color:#000;font-weight:bold">;</span>
        message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg2</span> <span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityViewId</span><span style="color:#000;font-weight:bold">(</span>accessibilityNodeId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

        SomeArgs args <span style="color:#000;font-weight:bold">=</span> SomeArgs<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obtain</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi1</span> <span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getVirtualDescendantId</span><span style="color:#000;font-weight:bold">(</span>accessibilityNodeId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi2</span> <span style="color:#000;font-weight:bold">=</span> action<span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi3</span> <span style="color:#000;font-weight:bold">=</span> interactionId<span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span> <span style="color:#000;font-weight:bold">=</span> callback<span style="color:#000;font-weight:bold">;</span>
        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg2</span> <span style="color:#000;font-weight:bold">=</span> arguments<span style="color:#000;font-weight:bold">;</span>

        message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obj</span> <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">;</span>

        scheduleMessage<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">,</span> interrogatingPid<span style="color:#000;font-weight:bold">,</span> interrogatingTid<span style="color:#000;font-weight:bold">,</span> CONSIDER_REQUEST_PREPARERS<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>


<span style="color:#998;font-style:italic">//Hander的handleMessage处理
</span><span style="color:#998;font-style:italic"></span> 		<span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">handleMessage</span><span style="color:#000;font-weight:bold">(</span>Message message<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> type <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">what</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">switch</span> <span style="color:#000;font-weight:bold">(</span>type<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">case</span> MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_ACCESSIBILITY_ID<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    findAccessibilityNodeInfoByAccessibilityIdUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> MSG_PERFORM_ACCESSIBILITY_ACTION<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    performAccessibilityActionUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//这里
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> MSG_FIND_ACCESSIBILITY_NODE_INFOS_BY_VIEW_ID<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    findAccessibilityNodeInfosByViewIdUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> MSG_FIND_ACCESSIBILITY_NODE_INFO_BY_TEXT<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    findAccessibilityNodeInfosByTextUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> MSG_FIND_FOCUS<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    findFocusUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> MSG_FOCUS_SEARCH<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    focusSearchUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> MSG_PREPARE_FOR_EXTRA_DATA_REQUEST<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    prepareForExtraDataRequestUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> MSG_APP_PREPARATION_FINISHED<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    requestPreparerDoneUiThread<span style="color:#000;font-weight:bold">(</span>message<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">case</span> MSG_APP_PREPARATION_TIMEOUT<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                    requestPreparerTimeoutUiThread<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">default</span><span style="color:#000;font-weight:bold">:</span>
                    <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> IllegalArgumentException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Unknown message type: &#34;</span> <span style="color:#000;font-weight:bold">+</span> type<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">performAccessibilityActionUiThread</span><span style="color:#000;font-weight:bold">(</span>Message message<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> flags <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> accessibilityViewId <span style="color:#000;font-weight:bold">=</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg2</span><span style="color:#000;font-weight:bold">;</span>

        SomeArgs args <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SomeArgs<span style="color:#000;font-weight:bold">)</span> message<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">obj</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> virtualDescendantId <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi1</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> action <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi2</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> interactionId <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">argi3</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> IAccessibilityInteractionConnectionCallback callback <span style="color:#000;font-weight:bold">=</span>
            <span style="color:#000;font-weight:bold">(</span>IAccessibilityInteractionConnectionCallback<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg1</span><span style="color:#000;font-weight:bold">;</span>
        Bundle arguments <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>Bundle<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">arg2</span><span style="color:#000;font-weight:bold">;</span>

        args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recycle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

        <span style="color:#458;font-weight:bold">boolean</span> succeeded <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mView</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mAttachInfo</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span>
                    mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mStopped</span> <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mPausedForTransition</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
            mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mAttachInfo</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mAccessibilityFetchFlags</span> <span style="color:#000;font-weight:bold">=</span> flags<span style="color:#000;font-weight:bold">;</span>
            View target <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>accessibilityViewId <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ROOT_ITEM_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                target <span style="color:#000;font-weight:bold">=</span> findViewByAccessibilityId<span style="color:#000;font-weight:bold">(</span>accessibilityViewId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                target <span style="color:#000;font-weight:bold">=</span> mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mView</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>target <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> isShown<span style="color:#000;font-weight:bold">(</span>target<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>action <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> R<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accessibilityActionClickOnClickableSpan</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#998;font-style:italic">// Handle this hidden action separately
</span><span style="color:#998;font-style:italic"></span>                    succeeded <span style="color:#000;font-weight:bold">=</span> handleClickableSpanActionUiThread<span style="color:#000;font-weight:bold">(</span>
                            target<span style="color:#000;font-weight:bold">,</span> virtualDescendantId<span style="color:#000;font-weight:bold">,</span> arguments<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
                    AccessibilityNodeProvider provider <span style="color:#000;font-weight:bold">=</span> target<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAccessibilityNodeProvider</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>provider <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        succeeded <span style="color:#000;font-weight:bold">=</span> provider<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">performAction</span><span style="color:#000;font-weight:bold">(</span>virtualDescendantId<span style="color:#000;font-weight:bold">,</span> action<span style="color:#000;font-weight:bold">,</span>
                                arguments<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>virtualDescendantId <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> AccessibilityNodeProvider<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">HOST_VIEW_ID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        succeeded <span style="color:#000;font-weight:bold">=</span> target<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">performAccessibilityAction</span><span style="color:#000;font-weight:bold">(</span>action<span style="color:#000;font-weight:bold">,</span> arguments<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">//这里
</span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                mViewRootImpl<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mAttachInfo</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mAccessibilityFetchFlags</span> <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span>
                callback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setPerformAccessibilityActionResult</span><span style="color:#000;font-weight:bold">(</span>succeeded<span style="color:#000;font-weight:bold">,</span> interactionId<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RemoteException re<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#998;font-style:italic">/* ignore - the other side will time out */</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们可以看到最终通过target.performAccessibilityAction调用到View的相关方法里</p>
<h4 id="2view">2.View</h4>
<blockquote>
<p>目录:</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">performAccessibilityAction</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> action<span style="color:#000;font-weight:bold">,</span> Bundle arguments<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mAccessibilityDelegate <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
          <span style="color:#000;font-weight:bold">return</span> mAccessibilityDelegate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">performAccessibilityAction</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> action<span style="color:#000;font-weight:bold">,</span> arguments<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
      <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
          <span style="color:#000;font-weight:bold">return</span> performAccessibilityActionInternal<span style="color:#000;font-weight:bold">(</span>action<span style="color:#000;font-weight:bold">,</span> arguments<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

 <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">performAccessibilityActionInternal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> action<span style="color:#000;font-weight:bold">,</span> Bundle arguments<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>isNestedScrollingEnabled<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span>
                <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">(</span>action <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_SCROLL_BACKWARD</span>
                <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> action <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_SCROLL_FORWARD</span>
                <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> action <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> R<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accessibilityActionScrollUp</span>
                <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> action <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> R<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accessibilityActionScrollLeft</span>
                <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> action <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> R<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accessibilityActionScrollDown</span>
                <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> action <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> R<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accessibilityActionScrollRight</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dispatchNestedPrePerformAccessibilityAction<span style="color:#000;font-weight:bold">(</span>action<span style="color:#000;font-weight:bold">,</span> arguments<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">switch</span> <span style="color:#000;font-weight:bold">(</span>action<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        	<span style="color:#998;font-style:italic">//点击事件
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_CLICK</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>isClickable<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    performClick<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_LONG_CLICK</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>isLongClickable<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    performLongClick<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_FOCUS</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>hasFocus<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#998;font-style:italic">// Get out of touch mode since accessibility
</span><span style="color:#998;font-style:italic"></span>                    <span style="color:#998;font-style:italic">// wants to move focus around.
</span><span style="color:#998;font-style:italic"></span>                    getViewRootImpl<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ensureTouchMode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> requestFocus<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_CLEAR_FOCUS</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>hasFocus<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    clearFocus<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">!</span>isFocused<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_SELECT</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>isSelected<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    setSelected<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> isSelected<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_CLEAR_SELECTION</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>isSelected<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    setSelected<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">!</span>isSelected<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_ACCESSIBILITY_FOCUS</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">!</span>isAccessibilityFocused<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">return</span> requestAccessibilityFocus<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_CLEAR_ACCESSIBILITY_FOCUS</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>isAccessibilityFocused<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    clearAccessibilityFocus<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_NEXT_AT_MOVEMENT_GRANULARITY</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>arguments <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> granularity <span style="color:#000;font-weight:bold">=</span> arguments<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInt</span><span style="color:#000;font-weight:bold">(</span>
                            AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_ARGUMENT_MOVEMENT_GRANULARITY_INT</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">boolean</span> extendSelection <span style="color:#000;font-weight:bold">=</span> arguments<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBoolean</span><span style="color:#000;font-weight:bold">(</span>
                            AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_ARGUMENT_EXTEND_SELECTION_BOOLEAN</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> traverseAtGranularity<span style="color:#000;font-weight:bold">(</span>granularity<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span> extendSelection<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_PREVIOUS_AT_MOVEMENT_GRANULARITY</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>arguments <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> granularity <span style="color:#000;font-weight:bold">=</span> arguments<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInt</span><span style="color:#000;font-weight:bold">(</span>
                            AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_ARGUMENT_MOVEMENT_GRANULARITY_INT</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">boolean</span> extendSelection <span style="color:#000;font-weight:bold">=</span> arguments<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBoolean</span><span style="color:#000;font-weight:bold">(</span>
                            AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_ARGUMENT_EXTEND_SELECTION_BOOLEAN</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> traverseAtGranularity<span style="color:#000;font-weight:bold">(</span>granularity<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span> extendSelection<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_SET_SELECTION</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                CharSequence text <span style="color:#000;font-weight:bold">=</span> getIterableTextForAccessibility<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>text <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> start <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>arguments <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">?</span> arguments<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInt</span><span style="color:#000;font-weight:bold">(</span>
                        AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_ARGUMENT_SELECTION_START_INT</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">-</span>1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">-</span>1<span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">int</span> end <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>arguments <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">?</span> arguments<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInt</span><span style="color:#000;font-weight:bold">(</span>
                AccessibilityNodeInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ACTION_ARGUMENT_SELECTION_END_INT</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">-</span>1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">-</span>1<span style="color:#000;font-weight:bold">;</span>
                <span style="color:#998;font-style:italic">// Only cursor position can be specified (selection length == 0)
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>getAccessibilitySelectionStart<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> start
                        <span style="color:#000;font-weight:bold">|</span><span style="color:#000;font-weight:bold">|</span> getAccessibilitySelectionEnd<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> end<span style="color:#000;font-weight:bold">)</span>
                        <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">(</span>start <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> end<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    setAccessibilitySelection<span style="color:#000;font-weight:bold">(</span>start<span style="color:#000;font-weight:bold">,</span> end<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    notifyViewAccessibilityStateChangedIfNeeded<span style="color:#000;font-weight:bold">(</span>
                            AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">CONTENT_CHANGE_TYPE_UNDEFINED</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> R<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accessibilityActionShowOnScreen</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mAttachInfo <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">final</span> Rect r <span style="color:#000;font-weight:bold">=</span> mAttachInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mTmpInvalRect</span><span style="color:#000;font-weight:bold">;</span>
                    getDrawingRect<span style="color:#000;font-weight:bold">(</span>r<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> requestRectangleOnScreen<span style="color:#000;font-weight:bold">(</span>r<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">case</span> R<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accessibilityActionContextClick</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>isContextClickable<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    performContextClick<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">performClick</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">final</span> <span style="color:#458;font-weight:bold">boolean</span> result<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">final</span> ListenerInfo li <span style="color:#000;font-weight:bold">=</span> mListenerInfo<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>li <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> li<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mOnClickListener</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            playSoundEffect<span style="color:#000;font-weight:bold">(</span>SoundEffectConstants<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">CLICK</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            li<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mOnClickListener</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">onClick</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//点击事件回调
</span><span style="color:#998;font-style:italic"></span>            result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
            result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        sendAccessibilityEvent<span style="color:#000;font-weight:bold">(</span>AccessibilityEvent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE_VIEW_CLICKED</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

        notifyEnterOrExitForAutoFillIfNeeded<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">return</span> result<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

</code></pre></td></tr></table>
</div>
</div><p>至此AccessibilityServic所有内容基本都分析完了</p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="http://blog.bingtan.online">冰炭不投day</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="http://blog.bingtan.online/posts/Android/Android%E4%B9%8B%E8%BE%85%E5%8A%A9%E6%9C%8D%E5%8A%A1%E4%B8%8B%E7%AF%87AccessibilityServic%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">http://blog.bingtan.online/posts/Android/Android%E4%B9%8B%E8%BE%85%E5%8A%A9%E6%9C%8D%E5%8A%A1%E4%B8%8B%E7%AF%87AccessibilityServic%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/Android/Android%E4%B9%8B%E8%BE%85%E5%8A%A9%E6%9C%8D%E5%8A%A1%E4%B8%8A%E7%AF%87AccessibilityService%E4%BD%BF%E7%94%A8/">Android之辅助服务上篇————AccessibilityService使用</a></li>
        
        <li><a href="/posts/Android/Android%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BBGestureDetectory/">Android源码阅读————GestureDetectory</a></li>
        
        <li><a href="/posts/Android/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0Activity%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F/">Android学习笔记————Activity的生命周期和启动模式</a></li>
        
        <li><a href="/posts/Android/Android%E5%B0%8F%E9%A1%B9%E7%9B%AE%E8%81%8A%E5%A4%A9%E5%AE%A4%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AF%87/">Android小项目————聊天室（网络编程篇)</a></li>
        
        <li><a href="/posts/Android/Android%E5%B0%8F%E9%A1%B9%E7%9B%AE-%E5%86%B0%E7%82%AD%E4%B8%8D%E6%8A%95de%E5%B0%8F%E8%AE%A1%E7%AE%97%E5%99%A8/">Android小项目————冰炭不投de小计算器</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='http://blog.bingtan.online/tags/Android'>Android</a></li>
                
                <li><a href='http://blog.bingtan.online/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB'>源码阅读</a></li>
                
            </ul>
            
        </div>
    </article>
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yourdiscussshortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "https://github.com/hsc396612325/HSCBlog/tree/gh-pages"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='http://blog.bingtan.online/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="http://blog.bingtan.online">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>

    
    <section class="widget">
        <h3 class="widget-title">文章目录</h3>
<ul class="widget-list">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#一前言">一.前言</a></li>
    <li><a href="#二接收accessibilityevent事件">二.接收AccessibilityEvent事件</a>
      <ul>
        <li><a href="#1view对点击事件的分发">1.View对点击事件的分发</a></li>
        <li><a href="#2accessibilitymanager">2.AccessibilityManager</a></li>
        <li><a href="#3accessibilityservice">3.AccessibilityService</a></li>
      </ul>
    </li>
    <li><a href="#三findaccessibilitynodeinfosbytext">三.findAccessibilityNodeInfosByText</a>
      <ul>
        <li><a href="#1accessibilitynodeinfo">1.AccessibilityNodeInfo</a></li>
        <li><a href="#2accessibilitymanagerservice">2.AccessibilityManagerService</a></li>
        <li><a href="#3viewrootimpl">3.ViewRootImpl</a></li>
        <li><a href="#4小结">4.小结</a></li>
      </ul>
    </li>
    <li><a href="#四performaction">四.performAction</a>
      <ul>
        <li><a href="#1accessibilityinteractioncontroller">1.AccessibilityInteractionController</a></li>
        <li><a href="#2view">2.View</a></li>
      </ul>
    </li>
  </ul>
</nav>
</ul>
    </section>
    

    

    

    
   
    

    

    
    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="http://blog.bingtan.online/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        &copy; 2020 <a href="http://blog.bingtan.online">冰炭不投day的博客 By 冰炭不投day</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/flysnow-org/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/douban.js'></script>

</body>

</html>